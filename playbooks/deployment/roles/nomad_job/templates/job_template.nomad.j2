job "{{ job.name }}" {
  {% if job.datacenters is defined %}
  datacenters = ["{{ job.datacenters | join('","') }}"]
  {% endif %}

  {% if job.constraint is defined %}
  {% for cons in job.constraint %}
  constraint {
  {% for k,v in cons.iteritems() %}
    {{ k }}  = "{{ v }}"
  {% endfor %}
  }
  {% endfor %}
  {% endif %}

  {% if job.type is defined %}type = "{{ job.type }}"{% endif %}

  {% if job['update'] is defined %}
  update {
  {% for k,v in job['update'].iteritems() %}
    {{ k }}  = "{{ v }}"
  {% endfor %}
  }
  {% endif %}

  {% if job['migrate'] is defined %}
  migrate {
  {% for k,v in job['migrate'].iteritems() %}
    {{ k }}  = "{{ v }}"
  {% endfor %}
  }
  {% endif %}

  {% if job['group'] is defined %}
  {% for group in job.group %}
  group "{{ group.name }}" {

    {% if group.count is defined %}count = {{ group.count }}{% endif %}

    {% if group.restart is defined %}
    restart {
    {% for k,v in group.restart.iteritems() %}
      {{ k }}  = "{{ v }}"
    {% endfor %}
    }
    {% endif %}

    {% if group.ephemeral_disk is defined %}
    ephemeral_disk {
    {% for k,v in group.ephemeral_disk.iteritems() %}
      {{ k }}  = "{{ v }}"
    {% endfor %}
    }
    {% endif %}


    {% if group.task is defined %}
    {% for task in group.task %}
    task "{{ task.name }}" {

      {% if task.driver is defined %}driver = "{{ task.driver }}"{% endif %}

      {% if task.config is defined %}
      config {
        {% if task.config.image is defined %}image = "{{ task.config.image }}"{% endif %}

        {% if task.config.auth is defined %}
        auth {
          {% for k,v in task.config.auth.iteritems() %}
            {{ k }}  = "{{ v }}"
          {% endfor %}
        }
        {% endif %}

        {% if task.config.port_map is defined %}
        port_map {
          {% for k,v in task.config.port_map.iteritems() %}
            {{ k }}  = "{{ v }}"
          {% endfor %}
        }
        {% endif %}
      }
      {% endif %}

      {% if task.env is defined %}
      env {
        {% for k,v in task.env.iteritems() %}
          {{ k }}  = "{{ v }}"
        {% endfor %}
      }
      {% endif %}

      {% if task.resources is defined %}
      resources {
        {% if task.resources.cpu is defined %}cpu    = {{ task.resources.cpu }}{% endif %}
        {% if task.resources.memory is defined %}memory = {{ task.resources.memory }}{% endif %}
        {% if task.resources.network is defined %}
        network {
          {% if task.resources.network.mbits is defined %}mbits = {{ task.resources.network.mbits }}{% endif %}
          {% if task.resources.network.mbits is defined %}port "{{ task.resources.network.port }}" {} {% endif %}
        }
        {% endif %}
      }
      {% endif %}

      {% for serv in task.service %}
      service {
        {% if serv.name is defined %}name = "{{ serv.name }}"{% endif %}
        {% if serv.tags is defined %}tags = ["{{ serv.tags | join('","') }}"]{% endif %}
        {% if serv.port is defined %}port = "{{ serv.port }}"{% endif %}
        {% if serv.check is defined -%}
        check {
          {% if serv.check.name is defined %}name     = "{{ serv.check.name }}"{% endif %}
          {% if serv.check.type is defined %}type     = "{{ serv.check.type }}"{% endif %}
          {% if serv.check.interval is defined %}interval     = "{{ serv.check.interval }}"{% endif %}
          {% if serv.check.timeout is defined %}timeout     = "{{ serv.check.timeout }}"{% endif %}
        }
        {% endif %}
      }
      {% endfor %}
    }
    {% endfor %}
    {% endif %}
  }
  {% endfor %}
  {% endif %}
}
